<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Prescrições PWA</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#111827">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Prescrições">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/1f2937/ffffff?text=Rx">
    <link rel="manifest" href="manifest.json">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .main-content {
            transition: margin-left 0.3s ease-in-out;
        }
        .ficha-verde-bg { background-color: #16a34a; }
        .ficha-vermelha-bg { background-color: #dc2626; }
        .ficha-verde-text { color: #4ade80; }
        .ficha-vermelha-text { color: #f87171; }
        .ficha-verde-border { border-color: #16a34a; }
        .ficha-vermelha-border { border-color: #dc2626; }
        
        .active-ficha {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
        }
        .content-card table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .content-card th, .content-card td {
            border: 1px solid #374151; /* gray-700 */
            padding: 0.75rem 1rem;
            text-align: left;
        }
        .content-card th {
            background-color: #1f2937; /* gray-800 */
            font-weight: 600;
        }
        .content-card ul {
            list-style-type: disc;
            padding-left: 20px;
        }
        .content-card li {
            margin-bottom: 0.5rem;
        }
        .prescription-box {
            border-left: 4px solid;
            padding: 1rem;
            background-color: #1f2937; /* gray-800 */
            margin-top: 1.5rem;
            border-radius: 0.5rem;
        }
        .prescription-box h4 {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <!-- Sidebar / Navigation -->
    <aside id="sidebar" class="sidebar bg-gray-800 w-64 fixed top-0 left-0 h-full shadow-lg p-4 z-20 transform -translate-x-full md:translate-x-0 border-r border-gray-700">
        <div class="flex items-center mb-6">
             <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-emerald-400 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M18.5,2H5.5A3.5,3.5,0,0,0,2,5.5v13A3.5,3.5,0,0,0,5.5,22h13A3.5,3.5,0,0,0,22,18.5V5.5A3.5,3.5,0,0,0,18.5,2ZM18,7.5a.5.5,0,0,1-.5.5h-11a.5.5,0,0,1,0-1h11A.5.5,0,0,1,18,7.5Zm0,4a.5.5,0,0,1-.5.5h-11a.5.5,0,0,1,0-1h11A.5.5,0,0,1,18,11.5Zm0,4a.5.5,0,0,1-.5.5h-11a.5.5,0,0,1,0-1h11A.5.5,0,0,1,18,15.5Z"/></svg>
            <h1 class="text-2xl font-bold text-white">Prescrevendo</h1>
        </div>
        <input type="text" id="search-bar" placeholder="Pesquisar condição..." class="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg mb-4 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <nav id="specialties-nav" class="overflow-y-auto h-[calc(100%-8rem)]">
            <!-- Specialties will be dynamically inserted here -->
        </nav>
    </aside>

    <!-- Main Content -->
    <main id="main-content" class="main-content md:ml-64 p-4 md:p-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
             <button id="menu-toggle" class="md:hidden p-2 rounded-md bg-gray-700 text-gray-300">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
            <h2 id="page-title" class="text-3xl font-bold text-center flex-grow text-white">Guia de Prescrições</h2>
            <div class="hidden md:block w-8"></div>
        </header>

        <!-- Ficha Selector -->
        <div class="flex justify-center gap-4 md:gap-8 mb-8">
            <button id="ficha-verde-btn" class="ficha-selector ficha-verde-bg text-white font-bold py-3 px-6 rounded-xl shadow-md w-full md:w-1/3 transition-all duration-300 active-ficha" data-ficha="verde">
                Ficha Verde
            </button>
            <button id="ficha-vermelha-btn" class="ficha-selector ficha-vermelha-bg text-white font-bold py-3 px-6 rounded-xl shadow-md w-full md:w-1/3 transition-all duration-300" data-ficha="vermelha">
                Ficha Amarela/Vermelha
            </button>
        </div>

        <!-- Content Display Area -->
        <div id="content-display" class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
            <!-- Content will be dynamically inserted here -->
             <div class="text-center text-gray-400 p-8">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                </svg>
                <p class="text-lg mt-4">Selecione uma ficha e uma especialidade para começar.</p>
                <p>Use a barra de pesquisa para encontrar uma condição específica.</p>
            </div>
        </div>
    </main>

    <!-- 
    Para que a funcionalidade de PWA (instalar o site como um aplicativo) funcione,
    crie um arquivo chamado 'manifest.json' na mesma pasta deste HTML com o seguinte conteúdo:

    {
      "name": "Guia de Prescrições PWA",
      "short_name": "Prescrições",
      "start_url": ".",
      "display": "standalone",
      "background_color": "#111827",
      "theme_color": "#111827",
      "description": "Um guia rápido de prescrições para o pronto socorro.",
      "icons": [
        {
          "src": "https://placehold.co/192x192/1f2937/ffffff?text=Rx",
          "sizes": "192x192",
          "type": "image/png"
        },
        {
          "src": "https://placehold.co/512x512/1f2937/ffffff?text=Rx",
          "sizes": "512x512",
          "type": "image/png"
        }
      ]
    }
    -->
    <script src="database.js"></script>
    <script>
        // --- Service Worker Registration for PWA ---
        if ('serviceWorker' in navigator) {
            const swContent = `
                const CACHE_NAME = 'prescricoes-pwa-cache-v1';
                const urlsToCache = [
                    './guia_prescricoes.html',
                    'https://cdn.tailwindcss.com',
                    'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap'
                ];

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => {
                                return cache.addAll(urlsToCache);
                            })
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => {
                                return response || fetch(event.request);
                            })
                    );
                });
            `;
            const blob = new Blob([swContent], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            window.addEventListener('load', () => {
                navigator.serviceWorker.register(swUrl)
                    .then(registration => console.log('ServiceWorker registration successful with scope: ', registration.scope))
                    .catch(error => console.log('ServiceWorker registration failed: ', error));
            });
        }

        // --- DOM Elements ---
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const menuToggle = document.getElementById('menu-toggle');
        const searchBar = document.getElementById('search-bar');
        const specialtiesNav = document.getElementById('specialties-nav');
        const contentDisplay = document.getElementById('content-display');
        const fichaVerdeBtn = document.getElementById('ficha-verde-btn');
        const fichaVermelhaBtn = document.getElementById('ficha-vermelha-btn');
        const pageTitle = document.getElementById('page-title');

        // --- State ---
        let currentFicha = 'verde';
        let currentSpecialty = null;
        let isSidebarOpen = false;

        // --- Functions ---

        function createPrescriptionHTML(prescricao) {
            const borderColorClass = prescricao.type === 'verde' ? 'ficha-verde-border' : 'ficha-vermelha-border';
            const textColorClass = prescricao.type === 'verde' ? 'ficha-verde-text' : 'ficha-vermelha-text';
            
            let itemsHTML = prescricao.items.map(item => `<li class="mb-2">${item}</li>`).join('');

            return `
                <div class="prescription-box ${borderColorClass} mb-4">
                    <h4 class="${textColorClass}">${prescricao.title}</h4>
                    <ul class="text-gray-300 space-y-1">${itemsHTML}</ul>
                </div>
            `;
        }

        function renderConditionDetails(specialtyKey, conditionKey) {
            const condition = prescrevendoData[currentFicha][specialtyKey][conditionKey];
            let html = `
                <button id="back-btn" class="mb-4 text-emerald-400 hover:underline">&larr; Voltar para ${specialtyKey}</button>
                <h2 class="text-4xl font-bold mb-2 text-white">${conditionKey}</h2>
                <p class="text-lg text-gray-400 mb-6">Especialidade: ${specialtyKey}</p>
                <div class="content-card">
                    ${condition.content}
                    ${condition.prescricoes && condition.prescricoes.length > 0 ? condition.prescricoes.map(createPrescriptionHTML).join('') : ''}
                </div>
            `;
            contentDisplay.innerHTML = html;
            document.getElementById('back-btn').addEventListener('click', () => renderConditions(specialtyKey));
            window.scrollTo(0, 0);
        }

        function renderConditions(specialtyKey) {
            currentSpecialty = specialtyKey;
            const conditions = prescrevendoData[currentFicha][specialtyKey];
            let html = `
                <h2 class="text-3xl font-bold mb-6 text-white">${specialtyKey}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            `;
            for (const conditionKey in conditions) {
                html += `
                    <button class="condition-btn text-left p-4 bg-gray-700 rounded-lg hover:bg-gray-600 hover:shadow-xl transition-all duration-200" data-specialty="${specialtyKey}" data-condition="${conditionKey}">
                        <h3 class="font-semibold text-lg text-gray-200">${conditionKey}</h3>
                    </button>
                `;
            }
            html += `</div>`;
            contentDisplay.innerHTML = html;

            document.querySelectorAll('.condition-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const specialty = e.currentTarget.dataset.specialty;
                    const condition = e.currentTarget.dataset.condition;
                    renderConditionDetails(specialty, condition);
                });
            });
        }
        
        function renderSpecialties(ficha) {
            const specialties = prescrevendoData[ficha];
            specialtiesNav.innerHTML = '';
            const ul = document.createElement('ul');
            ul.className = 'space-y-1';

            for (const key in specialties) {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = '#';
                a.textContent = key;
                a.className = 'block p-3 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200';
                a.dataset.specialty = key;
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    renderConditions(key);
                    if (isSidebarOpen) toggleSidebar();
                });
                li.appendChild(a);
                ul.appendChild(li);
            }
            specialtiesNav.appendChild(ul);
        }
        
        function filterAndRenderSearch(query) {
            if (!query) {
                if(currentSpecialty) {
                    renderConditions(currentSpecialty);
                } else {
                     contentDisplay.innerHTML = `<div class="text-center text-gray-400 p-8">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                        </svg>
                        <p class="text-lg mt-4">Selecione uma ficha e uma especialidade para começar.</p>
                     </div>`;
                }
                return;
            }

            let html = `
                <h2 class="text-3xl font-bold mb-6 text-white">Resultados da busca por "${query}"</h2>
                <div class="space-y-4">
            `;
            let found = false;

            for (const ficha in prescrevendoData) {
                 for (const specialtyKey in prescrevendoData[ficha]) {
                    for (const conditionKey in prescrevendoData[ficha][specialtyKey]) {
                        if (conditionKey.toLowerCase().includes(query.toLowerCase())) {
                            found = true;
                             html += `
                                <button class="condition-btn text-left p-4 bg-gray-700 rounded-lg hover:bg-gray-600 transition-all duration-200 w-full" data-ficha="${ficha}" data-specialty="${specialtyKey}" data-condition="${conditionKey}">
                                    <h3 class="font-semibold text-lg text-gray-200">${conditionKey}</h3>
                                    <p class="text-sm text-gray-500">Ficha: <span class="${ficha === 'verde' ? 'text-green-400' : 'text-red-400'} font-medium">${ficha === 'verde' ? 'Verde' : 'Amarela/Vermelha'}</span> | Especialidade: ${specialtyKey}</p>
                                </button>
                            `;
                        }
                    }
                }
            }
            
            if (!found) {
                html += '<p class="text-gray-500">Nenhuma condição encontrada.</p>';
            }

            html += `</div>`;
            contentDisplay.innerHTML = html;

            document.querySelectorAll('.condition-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const ficha = e.currentTarget.dataset.ficha;
                    const specialty = e.currentTarget.dataset.specialty;
                    const condition = e.currentTarget.dataset.condition;
                    
                    if(currentFicha !== ficha) {
                        switchFicha(ficha, false);
                    }
                    
                    renderConditionDetails(specialty, condition);
                });
            });
        }

        function switchFicha(newFicha, resetContent = true) {
            currentFicha = newFicha;
            renderSpecialties(newFicha);
             if(resetContent) {
                 currentSpecialty = null;
                 contentDisplay.innerHTML = `<div class="text-center text-gray-400 p-8">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                        </svg>
                        <p class="text-lg mt-4">Selecione uma especialidade para começar.</p>
                     </div>`;
                 searchBar.value = '';
             }
            
            pageTitle.textContent = newFicha === 'verde' ? 'Guia Ficha Verde' : 'Guia Ficha Amarela/Vermelha';
            
            if (newFicha === 'verde') {
                fichaVerdeBtn.classList.add('active-ficha');
                fichaVermelhaBtn.classList.remove('active-ficha');
                pageTitle.className = 'text-3xl font-bold text-center flex-grow ficha-verde-text';
            } else {
                fichaVermelhaBtn.classList.add('active-ficha');
                fichaVerdeBtn.classList.remove('active-ficha');
                pageTitle.className = 'text-3xl font-bold text-center flex-grow ficha-vermelha-text';
            }
        }
        
        function toggleSidebar() {
            isSidebarOpen = !isSidebarOpen;
            if (isSidebarOpen) {
                sidebar.classList.remove('-translate-x-full');
            } else {
                sidebar.classList.add('-translate-x-full');
            }
        }


        // --- Event Listeners ---
        fichaVerdeBtn.addEventListener('click', () => switchFicha('verde'));
        fichaVermelhaBtn.addEventListener('click', () => switchFicha('vermelha'));
        menuToggle.addEventListener('click', toggleSidebar);
        searchBar.addEventListener('input', (e) => filterAndRenderSearch(e.target.value));

        // Initial Load
        switchFicha('verde');

    </script>
</body>
</html>


